<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å‡çº§èº«ä»½</title>
    <link rel="stylesheet" href="http://www.libreeze.top/res/css/bootstrap/bootstrap.css">
    <script src="http://www.libreeze.top/res/js/jquery.js"></script>
    <script src="http://www.libreeze.top/res/js/vue.global.js"></script>
    <meta name="viewport"
          content="width=device-width,initial-scale=1"/>
    <link rel="stylesheet" href="css/styles_user_identity.css">
    <script>
        var _paq = window._paq = window._paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//www.libreeze.top/web/matomo/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
</head>
<body>

<section class="bg-dark">
    <div class="container d-flex align-items-center">
        <div class="nav navbar">
            <div class="navbar-brand text-light">
                <h2>aCloud</h2>
            </div>
        </div>
    </div>
</section>

<section id="main_body">
    <div class="container pt-5">
        <div>
            <h1 class="display-5 text-center">æ‚¨å¥½!{{username}}</h1>
            <div class="col-12 d-flex flex-column justify-content-center align-items-center">
                <div>
                    <p>ğŸ™‚ä»¥ä¸‹æä¾›äº†ä¸¤ç§èº«ä»½é€‰æ‹©ï¼Œè¯·é€‰æ‹©æ‚¨éœ€è¦å‡çº§çš„èº«ä»½ğŸ™‚</p>
                    <p>ğŸ¦‰æ‚¨å½“å‰çš„èº«ä»½æ˜¯:<label id="userIdentity" class="badge">æ™®é€šç”¨æˆ·</label></p>
                    <p>ğŸ¥—èº«ä»½åˆ°æœŸæ—¶é—´ä¸º:{{expireTime}}</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section>
    <div class="container pt-3" id="identity_body">
        <div class="d-flex flex-column flex-lg-row col-12 justify-content-center align-items-center-small text-center">
            <div class="col-12 col-lg-3 m-2 card">
                <div class="card-header bg-primary text-white">
                    <h3 class="text-center">é«˜çº§ç”¨æˆ·</h3>
                </div>
                <div class="card-body">
                    <p>ğŸ¿ï¸æœ€å¤§ä¸Šä¼ æ•°é‡é™åˆ¶:40å¼ </p>
                    <p>ğŸ¥æœ€å¤§ä¸Šä¼ å¤§å°é™åˆ¶:5M</p>
                    <p>â°æœ€å¤§å‚¨å­˜æ—¶é—´é™åˆ¶:7å¤©</p>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <h5 class="m-0">ç°ä»·:{{advance_price}}å…ƒ/{{advance_date}}å¤©</h5>
                    <button class="btn btn-primary mt-2">ç«‹å³å‡çº§</button>
                </div>
            </div>

            <div class="col-12 col-lg-3 m-2 card">
                <div class="card-header bg-warning">
                    <h3>è‡³å°Šç”¨æˆ·</h3>
                </div>
                <div class="card-body">
                    <p>ğŸ¿ï¸æœ€å¤§ä¸Šä¼ æ•°é‡é™åˆ¶:100å¼ </p>
                    <p>ğŸ¥æœ€å¤§ä¸Šä¼ å¤§å°é™åˆ¶:10M</p>
                    <p>â°æœ€å¤§å‚¨å­˜æ—¶é—´é™åˆ¶:30å¤©</p>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <h5 class="m-0">ç°ä»·:{{supreme_price}}å…ƒ/{{supreme_date}}å¤©</h5>
                    <button class="btn btn-primary mt-2">ç«‹å³å‡çº§</button>
                </div>
            </div>

            <div class="col-12 col-lg-3 m-2 card">
                <div class="card-header bg-success text-white">
                    <h3>æ¿€æ´»ç å‡çº§</h3>
                </div>
                <div class="card-body">
                    <p>è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„æ¿€æ´»ç </p>
                    <label>
                        <input v-model="verify_code" type="text" name="code" class="input-group-text text-start">
                    </label>
                    <p class="text-danger">ä¸€ä¸ªæ¿€æ´»ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡</p>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-end">
                    <button @click="submitCode" class="btn btn-primary mt-2">ç«‹å³å‡çº§</button>
                </div>
            </div>
        </div>
    </div>
</section>


<script type="module">

    let user_identity = 1;
    let user_token = "";

    Vue.createApp({
        data() {
            return {
                username: '',
                token:'',
                identity:1,
                expireTime:0
            }
        },
        mounted() {
            let string = location.search.split(['data='])[1];
            if (string.length!==0) {
                $.post("http://www.libreeze.top/web/aCloud/api/v1/guser.php",{
                    t:string
                },(result)=>{
                    let parse = JSON.parse(result);
                    this.token = parse['token'];
                    user_token = this.token;
                    this.username = parse['username'];
                    this.identity = parse['identity'];
                    user_identity = this.identity;
                    let expireTime = parse['identity_expire'];
                    let time = "æ— æœŸé™";
                    if (expireTime!=="0") {
                        let number = parseInt(expireTime);
                        if (expireTime.length<13) {
                            number=number*1000;
                        }
                        let date = new Date(number);
                        time = date.getFullYear()+"-"+(date.getUTCMonth()+1)+"-"+date.getDate();
                    }
                    this.expireTime = time;
                    let user_idn = "æ™®é€šç”¨æˆ·";
                    let user_cls = "bg-normal-user";
                    switch (this.identity) {
                        case '2':
                            user_idn = "é«˜çº§ç”¨æˆ·";
                            user_cls = "bg-l2-user";
                            break;
                        case '3':
                            user_idn = "è‡³å°Šç”¨æˆ·";
                            user_cls = "bg-l3-user";
                            break;
                    }
                    $('#userIdentity').empty().append(user_idn).addClass(user_cls);
                });
            }
        }
    }).mount("#main_body");

    Vue.createApp({
        data() {
            return {
                advance_price:0,
                advance_date:30,
                supreme_price:0,
                supreme_date:30,
                verify_code:""
            }
        },
        methods:{
            submitCode:function () {
                if (this.verify_code==="") {
                    alert("è¯·è¾“å…¥æ¿€æ´»ç ");
                } else {
                    $.post("../api/v1/improveUser.php",{
                        m:0,
                        token:user_token,
                        code:this.verify_code
                    },(result)=> {
                        console.log(result);
                        let parse = JSON.parse(result);
                        let parseElement = parse['code'];
                        if (parseElement === 1) {
                            alert("æ¿€æ´»æˆåŠŸ!æˆåŠŸæ¿€æ´»:"+parse['date']+"å¤©");
                            location.reload();
                        } else if (parseElement === 2) {
                            alert("æœªæ‰¾åˆ°æ¿€æ´»ç æˆ–å·²è¢«ä½¿ç”¨!");
                        } else {
                            alert("æ¿€æ´»å¤±è´¥!è¯·æ£€æŸ¥ç½‘ç»œç¯å¢ƒ");
                        }
                    })
                }
            }
        },
        mounted() {
            // http://www.libreeze.top/web/aCloud
            $.get("http://www.libreeze.top/web/aCloud/api/v1/gprice.php",(result)=>{
                let parse = JSON.parse(result);
                let parseElement = parse['advance'];
                this.advance_price = parseElement['price'];
                this.advance_date = parseElement['date'];
                let parseElement1 = parse['supreme'];
                this.supreme_price = parseElement1['price'];
                this.supreme_date = parseElement1['date'];
            })
        }
    }).mount("#identity_body");

</script>

</body>
</html>